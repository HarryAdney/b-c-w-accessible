---
import ParishCouncilLayout from '../layouts/ParishCouncilLayout.astro'
import Hero from '../components/Hero.astro'
import { getCollection } from 'astro:content'

// Get all events from the collection
const allEvents = await getCollection('events')

// Get current date for filtering
const currentDate = new Date()
const currentDateString = currentDate.toISOString().split('T')[0]

// Filter for upcoming events only
const upcomingEvents = allEvents.filter(event => event.data.date >= currentDateString)

// Sort events by date (earliest first)
const sortedEvents = upcomingEvents.sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())

// Function to format date for display
function formatDate(dateString) {
  const date = new Date(dateString)
  return date.toLocaleDateString('en-GB', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

// Function to get category color class
function getCategoryColor(category) {
  switch (category.toLowerCase()) {
    case 'parish council':
      return 'bg-blue-100 text-blue-800'
    case 'community':
      return 'bg-green-100 text-green-800'
    case 'seasonal':
      return 'bg-purple-100 text-purple-800'
    case 'health':
      return 'bg-red-100 text-red-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}
---

<ParishCouncilLayout title="Village Events">
  <Hero />
  <main class="container px-6 py-10 mx-auto">
    <div class="grid gap-6 md:grid-cols-3">
      <div class="md:col-span-2">
        <h1 class="text-xl font-bold">Village Events</h1>

        <p class="mt-4">
          Stay up to date with upcoming events in West Burton. From Parish Council meetings to community celebrations,
          there's always something happening in our vibrant village community.
        </p>

        {sortedEvents.length === 0 ? (
          <div class="p-6 mt-8 rounded-lg bg-gray-50">
            <p class="text-gray-600">No upcoming events scheduled at the moment. Please check back soon!</p>
          </div>
        ) : (
          <div class="mt-8 space-y-6">
            {sortedEvents.map((event) => (
              <article class="p-6 transition-shadow bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md">
                <div class="flex flex-wrap items-start justify-between gap-4 mb-4">
                  <div class="flex-1">
                    <h2 class="mb-2 text-lg font-semibold text-gray-900">{event.data.title}</h2>
                    <div class="flex flex-wrap gap-2 mb-3">
                      <span class={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(event.data.category)}`}>
                        {event.data.category}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="grid gap-3 mb-4 text-sm text-gray-600 sm:grid-cols-2 lg:grid-cols-3">
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span>{formatDate(event.data.date)}</span>
                  </div>

                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>{event.data.time}</span>
                  </div>

                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>{event.data.location}</span>
                  </div>
                </div>

                <p class="mb-4 text-gray-700">{event.data.description}</p>

                <div class="pt-4 border-t">
                  <div class="mt-3 text-sm text-gray-500">
                    <span class="font-medium">Organized by:</span> {event.data.organizer}
                  </div>
                </div>
              </article>
            ))}
          </div>
        )}
      </div>

      <aside>
        <h2 class="text-xl font-bold">Event Categories</h2>
        <div class="mt-4 space-y-2">
          <div class="flex items-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mr-2">
              Parish Council
            </span>
            <span class="text-sm text-gray-600">Official council meetings</span>
          </div>
          <div class="flex items-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 mr-2">
              Community
            </span>
            <span class="text-sm text-gray-600">Village gatherings & activities</span>
          </div>
          <div class="flex items-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 mr-2">
              Seasonal
            </span>
            <span class="text-sm text-gray-600">Holiday celebrations</span>
          </div>
          <div class="flex items-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 mr-2">
              Health
            </span>
            <span class="text-sm text-gray-600">Health & wellbeing</span>
          </div>
        </div>

        <div class="mt-8">
          <h3 class="mb-4 text-lg font-semibold">Submit an Event</h3>
          <p class="mb-4 text-sm text-gray-600">
            Have an event to share with the community? Contact the Parish Council to have it added to our events calendar.
          </p>
          <a
            href="mailto:clerk@burtoncumwalden-pc.gov.uk"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-white transition-colors bg-blue-600 rounded-md hover:bg-blue-700"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            Contact Us
          </a>
        </div>
      </aside>
    </div>
  </main>
</ParishCouncilLayout>